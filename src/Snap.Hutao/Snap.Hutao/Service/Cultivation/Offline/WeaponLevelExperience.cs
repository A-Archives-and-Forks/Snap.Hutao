// Copyright (c) DGP Studio. All rights reserved.
// Licensed under the MIT license.

using Snap.Hutao.Core.ExceptionService;
using Snap.Hutao.Model.Intrinsic;
using System.Collections.Frozen;

namespace Snap.Hutao.Service.Cultivation.Offline;

internal static class WeaponLevelExperience
{
    private static readonly FrozenDictionary<int, int> FiveStarLevelExperienceData = FrozenDictionary.ToFrozenDictionary(
    [
        KeyValuePair.Create(1, 600),
        KeyValuePair.Create(2, 950),
        KeyValuePair.Create(3, 1350),
        KeyValuePair.Create(4, 1800),
        KeyValuePair.Create(5, 2325),
        KeyValuePair.Create(6, 2925),
        KeyValuePair.Create(7, 3525),
        KeyValuePair.Create(8, 4200),
        KeyValuePair.Create(9, 4950),
        KeyValuePair.Create(10, 5700),
        KeyValuePair.Create(11, 6525),
        KeyValuePair.Create(12, 7400),
        KeyValuePair.Create(13, 8300),
        KeyValuePair.Create(14, 9225),
        KeyValuePair.Create(15, 10200),
        KeyValuePair.Create(16, 11250),
        KeyValuePair.Create(17, 12300),
        KeyValuePair.Create(18, 13425),
        KeyValuePair.Create(19, 14600),
        KeyValuePair.Create(20, 15750),
        KeyValuePair.Create(21, 17850),
        KeyValuePair.Create(22, 19175),
        KeyValuePair.Create(23, 20550),
        KeyValuePair.Create(24, 21975),
        KeyValuePair.Create(25, 23450),
        KeyValuePair.Create(26, 24950),
        KeyValuePair.Create(27, 26475),
        KeyValuePair.Create(28, 28050),
        KeyValuePair.Create(29, 29675),
        KeyValuePair.Create(30, 31350),
        KeyValuePair.Create(31, 33050),
        KeyValuePair.Create(32, 34800),
        KeyValuePair.Create(33, 36575),
        KeyValuePair.Create(34, 38400),
        KeyValuePair.Create(35, 40250),
        KeyValuePair.Create(36, 42150),
        KeyValuePair.Create(37, 44100),
        KeyValuePair.Create(38, 46100),
        KeyValuePair.Create(39, 48125),
        KeyValuePair.Create(40, 50150),
        KeyValuePair.Create(41, 54875),
        KeyValuePair.Create(42, 57125),
        KeyValuePair.Create(43, 59400),
        KeyValuePair.Create(44, 61725),
        KeyValuePair.Create(45, 64100),
        KeyValuePair.Create(46, 66500),
        KeyValuePair.Create(47, 68925),
        KeyValuePair.Create(48, 71400),
        KeyValuePair.Create(49, 73950),
        KeyValuePair.Create(50, 76500),
        KeyValuePair.Create(51, 83075),
        KeyValuePair.Create(52, 85850),
        KeyValuePair.Create(53, 88650),
        KeyValuePair.Create(54, 91550),
        KeyValuePair.Create(55, 94425),
        KeyValuePair.Create(56, 97400),
        KeyValuePair.Create(57, 100350),
        KeyValuePair.Create(58, 103400),
        KeyValuePair.Create(59, 106475),
        KeyValuePair.Create(60, 109575),
        KeyValuePair.Create(61, 118350),
        KeyValuePair.Create(62, 121700),
        KeyValuePair.Create(63, 125100),
        KeyValuePair.Create(64, 128550),
        KeyValuePair.Create(65, 132050),
        KeyValuePair.Create(66, 135575),
        KeyValuePair.Create(67, 139125),
        KeyValuePair.Create(68, 142725),
        KeyValuePair.Create(69, 146375),
        KeyValuePair.Create(70, 150075),
        KeyValuePair.Create(71, 161525),
        KeyValuePair.Create(72, 165500),
        KeyValuePair.Create(73, 169500),
        KeyValuePair.Create(74, 173550),
        KeyValuePair.Create(75, 177650),
        KeyValuePair.Create(76, 181800),
        KeyValuePair.Create(77, 186000),
        KeyValuePair.Create(78, 190250),
        KeyValuePair.Create(79, 194525),
        KeyValuePair.Create(80, 198875),
        KeyValuePair.Create(81, 234725),
        KeyValuePair.Create(82, 263825),
        KeyValuePair.Create(83, 296400),
        KeyValuePair.Create(84, 332975),
        KeyValuePair.Create(85, 373950),
        KeyValuePair.Create(86, 419925),
        KeyValuePair.Create(87, 471375),
        KeyValuePair.Create(88, 529050),
        KeyValuePair.Create(89, 593675),
        KeyValuePair.Create(90, 0),
    ]);

    private static readonly FrozenDictionary<int, int> FourStarLevelExperienceData = FrozenDictionary.ToFrozenDictionary(
    [
        KeyValuePair.Create(1, 400),
        KeyValuePair.Create(2, 625),
        KeyValuePair.Create(3, 900),
        KeyValuePair.Create(4, 1200),
        KeyValuePair.Create(5, 1550),
        KeyValuePair.Create(6, 1950),
        KeyValuePair.Create(7, 2350),
        KeyValuePair.Create(8, 2800),
        KeyValuePair.Create(9, 3300),
        KeyValuePair.Create(10, 3800),
        KeyValuePair.Create(11, 4350),
        KeyValuePair.Create(12, 4925),
        KeyValuePair.Create(13, 5525),
        KeyValuePair.Create(14, 6150),
        KeyValuePair.Create(15, 6800),
        KeyValuePair.Create(16, 7500),
        KeyValuePair.Create(17, 8200),
        KeyValuePair.Create(18, 8950),
        KeyValuePair.Create(19, 9725),
        KeyValuePair.Create(20, 10500),
        KeyValuePair.Create(21, 11900),
        KeyValuePair.Create(22, 12775),
        KeyValuePair.Create(23, 13700),
        KeyValuePair.Create(24, 14650),
        KeyValuePair.Create(25, 15625),
        KeyValuePair.Create(26, 16625),
        KeyValuePair.Create(27, 17650),
        KeyValuePair.Create(28, 18700),
        KeyValuePair.Create(29, 19775),
        KeyValuePair.Create(30, 20900),
        KeyValuePair.Create(31, 22025),
        KeyValuePair.Create(32, 23200),
        KeyValuePair.Create(33, 24375),
        KeyValuePair.Create(34, 25600),
        KeyValuePair.Create(35, 26825),
        KeyValuePair.Create(36, 28100),
        KeyValuePair.Create(37, 29400),
        KeyValuePair.Create(38, 30725),
        KeyValuePair.Create(39, 32075),
        KeyValuePair.Create(40, 33425),
        KeyValuePair.Create(41, 36575),
        KeyValuePair.Create(42, 38075),
        KeyValuePair.Create(43, 39600),
        KeyValuePair.Create(44, 41150),
        KeyValuePair.Create(45, 42725),
        KeyValuePair.Create(46, 44325),
        KeyValuePair.Create(47, 45950),
        KeyValuePair.Create(48, 47600),
        KeyValuePair.Create(49, 49300),
        KeyValuePair.Create(50, 51000),
        KeyValuePair.Create(51, 55375),
        KeyValuePair.Create(52, 57225),
        KeyValuePair.Create(53, 59100),
        KeyValuePair.Create(54, 61025),
        KeyValuePair.Create(55, 62950),
        KeyValuePair.Create(56, 64925),
        KeyValuePair.Create(57, 66900),
        KeyValuePair.Create(58, 68925),
        KeyValuePair.Create(59, 70975),
        KeyValuePair.Create(60, 73050),
        KeyValuePair.Create(61, 78900),
        KeyValuePair.Create(62, 81125),
        KeyValuePair.Create(63, 83400),
        KeyValuePair.Create(64, 85700),
        KeyValuePair.Create(65, 88025),
        KeyValuePair.Create(66, 90375),
        KeyValuePair.Create(67, 92750),
        KeyValuePair.Create(68, 95150),
        KeyValuePair.Create(69, 97575),
        KeyValuePair.Create(70, 100050),
        KeyValuePair.Create(71, 107675),
        KeyValuePair.Create(72, 110325),
        KeyValuePair.Create(73, 113000),
        KeyValuePair.Create(74, 115700),
        KeyValuePair.Create(75, 118425),
        KeyValuePair.Create(76, 121200),
        KeyValuePair.Create(77, 124000),
        KeyValuePair.Create(78, 126825),
        KeyValuePair.Create(79, 129675),
        KeyValuePair.Create(80, 132575),
        KeyValuePair.Create(81, 156475),
        KeyValuePair.Create(82, 175875),
        KeyValuePair.Create(83, 197600),
        KeyValuePair.Create(84, 221975),
        KeyValuePair.Create(85, 249300),
        KeyValuePair.Create(86, 279950),
        KeyValuePair.Create(87, 314250),
        KeyValuePair.Create(88, 352700),
        KeyValuePair.Create(89, 395775),
        KeyValuePair.Create(90, 0),
    ]);

    private static readonly FrozenDictionary<int, int> ThreeStarLevelExperienceData = FrozenDictionary.ToFrozenDictionary(
    [
        KeyValuePair.Create(1, 275),
        KeyValuePair.Create(2, 425),
        KeyValuePair.Create(3, 600),
        KeyValuePair.Create(4, 800),
        KeyValuePair.Create(5, 1025),
        KeyValuePair.Create(6, 1275),
        KeyValuePair.Create(7, 1550),
        KeyValuePair.Create(8, 1850),
        KeyValuePair.Create(9, 2175),
        KeyValuePair.Create(10, 2500),
        KeyValuePair.Create(11, 2875),
        KeyValuePair.Create(12, 3250),
        KeyValuePair.Create(13, 3650),
        KeyValuePair.Create(14, 4050),
        KeyValuePair.Create(15, 4500),
        KeyValuePair.Create(16, 4950),
        KeyValuePair.Create(17, 5400),
        KeyValuePair.Create(18, 5900),
        KeyValuePair.Create(19, 6425),
        KeyValuePair.Create(20, 6925),
        KeyValuePair.Create(21, 7850),
        KeyValuePair.Create(22, 8425),
        KeyValuePair.Create(23, 9050),
        KeyValuePair.Create(24, 9675),
        KeyValuePair.Create(25, 10325),
        KeyValuePair.Create(26, 10975),
        KeyValuePair.Create(27, 11650),
        KeyValuePair.Create(28, 12350),
        KeyValuePair.Create(29, 13050),
        KeyValuePair.Create(30, 13800),
        KeyValuePair.Create(31, 14525),
        KeyValuePair.Create(32, 15300),
        KeyValuePair.Create(33, 16100),
        KeyValuePair.Create(34, 16900),
        KeyValuePair.Create(35, 17700),
        KeyValuePair.Create(36, 18550),
        KeyValuePair.Create(37, 19400),
        KeyValuePair.Create(38, 20275),
        KeyValuePair.Create(39, 21175),
        KeyValuePair.Create(40, 22050),
        KeyValuePair.Create(41, 24150),
        KeyValuePair.Create(42, 25125),
        KeyValuePair.Create(43, 26125),
        KeyValuePair.Create(44, 27150),
        KeyValuePair.Create(45, 28200),
        KeyValuePair.Create(46, 29250),
        KeyValuePair.Create(47, 30325),
        KeyValuePair.Create(48, 31425),
        KeyValuePair.Create(49, 32550),
        KeyValuePair.Create(50, 33650),
        KeyValuePair.Create(51, 36550),
        KeyValuePair.Create(52, 37775),
        KeyValuePair.Create(53, 39000),
        KeyValuePair.Create(54, 40275),
        KeyValuePair.Create(55, 41550),
        KeyValuePair.Create(56, 42850),
        KeyValuePair.Create(57, 44150),
        KeyValuePair.Create(58, 45500),
        KeyValuePair.Create(59, 46850),
        KeyValuePair.Create(60, 48225),
        KeyValuePair.Create(61, 52075),
        KeyValuePair.Create(62, 53550),
        KeyValuePair.Create(63, 55050),
        KeyValuePair.Create(64, 56550),
        KeyValuePair.Create(65, 58100),
        KeyValuePair.Create(66, 59650),
        KeyValuePair.Create(67, 61225),
        KeyValuePair.Create(68, 62800),
        KeyValuePair.Create(69, 64400),
        KeyValuePair.Create(70, 66025),
        KeyValuePair.Create(71, 71075),
        KeyValuePair.Create(72, 72825),
        KeyValuePair.Create(73, 74575),
        KeyValuePair.Create(74, 76350),
        KeyValuePair.Create(75, 78150),
        KeyValuePair.Create(76, 80000),
        KeyValuePair.Create(77, 81850),
        KeyValuePair.Create(78, 83700),
        KeyValuePair.Create(79, 85575),
        KeyValuePair.Create(80, 87500),
        KeyValuePair.Create(81, 103275),
        KeyValuePair.Create(82, 116075),
        KeyValuePair.Create(83, 130425),
        KeyValuePair.Create(84, 146500),
        KeyValuePair.Create(85, 164550),
        KeyValuePair.Create(86, 184775),
        KeyValuePair.Create(87, 207400),
        KeyValuePair.Create(88, 232775),
        KeyValuePair.Create(89, 261200),
        KeyValuePair.Create(90, 0),
    ]);

    private static readonly FrozenDictionary<int, int> TwoStarLevelExperienceData = FrozenDictionary.ToFrozenDictionary(
    [
        KeyValuePair.Create(1, 175),
        KeyValuePair.Create(2, 275),
        KeyValuePair.Create(3, 400),
        KeyValuePair.Create(4, 550),
        KeyValuePair.Create(5, 700),
        KeyValuePair.Create(6, 875),
        KeyValuePair.Create(7, 1050),
        KeyValuePair.Create(8, 1250),
        KeyValuePair.Create(9, 1475),
        KeyValuePair.Create(10, 1700),
        KeyValuePair.Create(11, 1950),
        KeyValuePair.Create(12, 2225),
        KeyValuePair.Create(13, 2475),
        KeyValuePair.Create(14, 2775),
        KeyValuePair.Create(15, 3050),
        KeyValuePair.Create(16, 3375),
        KeyValuePair.Create(17, 3700),
        KeyValuePair.Create(18, 4025),
        KeyValuePair.Create(19, 4375),
        KeyValuePair.Create(20, 4725),
        KeyValuePair.Create(21, 5350),
        KeyValuePair.Create(22, 5750),
        KeyValuePair.Create(23, 6175),
        KeyValuePair.Create(24, 6600),
        KeyValuePair.Create(25, 7025),
        KeyValuePair.Create(26, 7475),
        KeyValuePair.Create(27, 7950),
        KeyValuePair.Create(28, 8425),
        KeyValuePair.Create(29, 8900),
        KeyValuePair.Create(30, 9400),
        KeyValuePair.Create(31, 9900),
        KeyValuePair.Create(32, 10450),
        KeyValuePair.Create(33, 10975),
        KeyValuePair.Create(34, 11525),
        KeyValuePair.Create(35, 12075),
        KeyValuePair.Create(36, 12650),
        KeyValuePair.Create(37, 13225),
        KeyValuePair.Create(38, 13825),
        KeyValuePair.Create(39, 14425),
        KeyValuePair.Create(40, 15050),
        KeyValuePair.Create(41, 16450),
        KeyValuePair.Create(42, 17125),
        KeyValuePair.Create(43, 17825),
        KeyValuePair.Create(44, 18525),
        KeyValuePair.Create(45, 19225),
        KeyValuePair.Create(46, 19950),
        KeyValuePair.Create(47, 20675),
        KeyValuePair.Create(48, 21425),
        KeyValuePair.Create(49, 22175),
        KeyValuePair.Create(50, 22950),
        KeyValuePair.Create(51, 24925),
        KeyValuePair.Create(52, 25750),
        KeyValuePair.Create(53, 26600),
        KeyValuePair.Create(54, 27450),
        KeyValuePair.Create(55, 28325),
        KeyValuePair.Create(56, 29225),
        KeyValuePair.Create(57, 30100),
        KeyValuePair.Create(58, 31025),
        KeyValuePair.Create(59, 31950),
        KeyValuePair.Create(60, 32875),
        KeyValuePair.Create(61, 35500),
        KeyValuePair.Create(62, 36500),
        KeyValuePair.Create(63, 37525),
        KeyValuePair.Create(64, 38575),
        KeyValuePair.Create(65, 39600),
        KeyValuePair.Create(66, 40675),
        KeyValuePair.Create(67, 41750),
        KeyValuePair.Create(68, 42825),
        KeyValuePair.Create(69, 43900),
        KeyValuePair.Create(70, 0),
    ]);

    private static readonly FrozenDictionary<int, int> OneStarLevelExperienceData = FrozenDictionary.ToFrozenDictionary(
    [
        KeyValuePair.Create(1, 125),
        KeyValuePair.Create(2, 200),
        KeyValuePair.Create(3, 275),
        KeyValuePair.Create(4, 350),
        KeyValuePair.Create(5, 475),
        KeyValuePair.Create(6, 575),
        KeyValuePair.Create(7, 700),
        KeyValuePair.Create(8, 850),
        KeyValuePair.Create(9, 1000),
        KeyValuePair.Create(10, 1150),
        KeyValuePair.Create(11, 1300),
        KeyValuePair.Create(12, 1475),
        KeyValuePair.Create(13, 1650),
        KeyValuePair.Create(14, 1850),
        KeyValuePair.Create(15, 2050),
        KeyValuePair.Create(16, 2250),
        KeyValuePair.Create(17, 2450),
        KeyValuePair.Create(18, 2675),
        KeyValuePair.Create(19, 2925),
        KeyValuePair.Create(20, 3150),
        KeyValuePair.Create(21, 3575),
        KeyValuePair.Create(22, 3825),
        KeyValuePair.Create(23, 4100),
        KeyValuePair.Create(24, 4400),
        KeyValuePair.Create(25, 4700),
        KeyValuePair.Create(26, 5000),
        KeyValuePair.Create(27, 5300),
        KeyValuePair.Create(28, 5600),
        KeyValuePair.Create(29, 5925),
        KeyValuePair.Create(30, 6275),
        KeyValuePair.Create(31, 6600),
        KeyValuePair.Create(32, 6950),
        KeyValuePair.Create(33, 7325),
        KeyValuePair.Create(34, 7675),
        KeyValuePair.Create(35, 8050),
        KeyValuePair.Create(36, 8425),
        KeyValuePair.Create(37, 8825),
        KeyValuePair.Create(38, 9225),
        KeyValuePair.Create(39, 9625),
        KeyValuePair.Create(40, 10025),
        KeyValuePair.Create(41, 10975),
        KeyValuePair.Create(42, 11425),
        KeyValuePair.Create(43, 11875),
        KeyValuePair.Create(44, 12350),
        KeyValuePair.Create(45, 12825),
        KeyValuePair.Create(46, 13300),
        KeyValuePair.Create(47, 13775),
        KeyValuePair.Create(48, 14275),
        KeyValuePair.Create(49, 14800),
        KeyValuePair.Create(50, 15300),
        KeyValuePair.Create(51, 16625),
        KeyValuePair.Create(52, 17175),
        KeyValuePair.Create(53, 17725),
        KeyValuePair.Create(54, 18300),
        KeyValuePair.Create(55, 18875),
        KeyValuePair.Create(56, 19475),
        KeyValuePair.Create(57, 20075),
        KeyValuePair.Create(58, 20675),
        KeyValuePair.Create(59, 21300),
        KeyValuePair.Create(60, 21925),
        KeyValuePair.Create(61, 23675),
        KeyValuePair.Create(62, 24350),
        KeyValuePair.Create(63, 25025),
        KeyValuePair.Create(64, 25700),
        KeyValuePair.Create(65, 26400),
        KeyValuePair.Create(66, 27125),
        KeyValuePair.Create(67, 27825),
        KeyValuePair.Create(68, 28550),
        KeyValuePair.Create(69, 29275),
        KeyValuePair.Create(70, 0),
    ]);

    public static int GetExperienceToNextLevel(QualityType quality, int level)
    {
        if (level >= GetMaxLevel(quality))
        {
            return 0;
        }

        FrozenDictionary<int, int> levelData = quality switch
        {
            QualityType.QUALITY_ORANGE => FiveStarLevelExperienceData,
            QualityType.QUALITY_PURPLE => FourStarLevelExperienceData,
            QualityType.QUALITY_BLUE => ThreeStarLevelExperienceData,
            QualityType.QUALITY_GREEN => TwoStarLevelExperienceData,
            QualityType.QUALITY_WHITE => OneStarLevelExperienceData,
            _ => throw HutaoException.NotSupported(),
        };

        return levelData.TryGetValue(level, out int experience) ? experience : 0;
    }

    public static int CalculateTotalExperience(QualityType quality, int currentLevel, int targetLevel)
    {
        int maxLevel = GetMaxLevel(quality);
        if (currentLevel >= targetLevel || currentLevel >= maxLevel)
        {
            return 0;
        }

        int totalExperience = 0;
        for (int level = currentLevel; level < targetLevel && level < maxLevel; level++)
        {
            totalExperience += GetExperienceToNextLevel(quality, level);
        }

        return totalExperience;
    }

    private static int GetMaxLevel(QualityType quality)
    {
        return quality switch
        {
            QualityType.QUALITY_WHITE or QualityType.QUALITY_GREEN => 70,
            QualityType.QUALITY_BLUE or QualityType.QUALITY_PURPLE or QualityType.QUALITY_ORANGE => 90,
            _ => throw HutaoException.NotSupported(),
        };
    }
}