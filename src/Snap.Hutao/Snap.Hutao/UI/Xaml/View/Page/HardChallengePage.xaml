<shuxc:ScopedPage
    x:Class="Snap.Hutao.UI.Xaml.View.Page.HardChallengePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cw="using:CommunityToolkit.WinUI"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Snap.Hutao.UI.Xaml.View.Page"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mxi="using:Microsoft.Xaml.Interactivity"
    xmlns:shuxb="using:Snap.Hutao.UI.Xaml.Behavior"
    xmlns:shuxc="using:Snap.Hutao.UI.Xaml.Control"
    xmlns:shuxcc="using:Snap.Hutao.UI.Xaml.Control.Card"
    xmlns:shuxm="using:Snap.Hutao.UI.Xaml.Markup"
    xmlns:shvh="using:Snap.Hutao.ViewModel.HardChallenge"
    d:DataContext="{d:DesignInstance shvh:HardChallengeViewModel}"
    mc:Ignorable="d">

    <mxi:Interaction.Behaviors>
        <shuxb:InvokeCommandOnLoadedBehavior Command="{Binding LoadCommand}"/>
    </mxi:Interaction.Behaviors>

    <Page.Resources>
        <DataTemplate x:Key="HardChallengeListTemplate" x:DataType="shvh:HardChallengeView">
            <StackPanel Margin="0,6,0,8">
                <TextBlock Text="{Binding Schedule}"/>
                <MenuFlyoutSeparator Margin="3,2"/>
                <TextBlock
                    Opacity="0.6"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Text="{Binding FormattedTime}"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="AvatarViewTemplate" x:DataType="shvh:AvatarView">
            <shuxcc:VerticalCard>
                <shuxcc:VerticalCard.Top>
                    <shuxc:ItemIcon Icon="{Binding Icon}" Quality="{Binding Quality}"/>
                </shuxcc:VerticalCard.Top>
                <shuxcc:VerticalCard.Bottom>
                    <TextBlock Text="{Binding Name}"/>
                </shuxcc:VerticalCard.Bottom>
            </shuxcc:VerticalCard>
        </DataTemplate>
    </Page.Resources>

    <Grid>
        <Pivot Style="{ThemeResource CardPivotStyle}">
            <Pivot.RightHeader>
                <CommandBar Grid.Row="0" DefaultLabelPosition="Right">
                    <AppBarButton
                        Command="{Binding RefreshCommand}"
                        Icon="{shuxm:FontIcon Glyph=&#xE72C;}"
                        Label="{shuxm:ResourceString Name=ViewSpiralAbyssRefresh}"/>
                </CommandBar>
            </Pivot.RightHeader>

            <PivotItem Header="{shuxm:ResourceString Name=ViewSpiralAbyssDetail}">
                <Border Margin="16" cw:Effects.Shadow="{ThemeResource CompatCardShadow}">
                    <Border Style="{ThemeResource AcrylicBorderCardStyle}">
                        <SplitView
                            DisplayMode="Inline"
                            IsPaneOpen="True"
                            OpenPaneLength="248"
                            PaneBackground="Transparent">
                            <SplitView.Pane>
                                <ListView
                                    Padding="{ThemeResource ListViewInSplitPanePadding}"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    ItemTemplate="{StaticResource HardChallengeListTemplate}"
                                    ItemsSource="{Binding HardChallengeEntries}"
                                    SelectedItem="{Binding HardChallengeEntries.CurrentItem, Mode=TwoWay}"/>
                            </SplitView.Pane>
                            <SplitView.Content>
                                <ScrollViewer>
                                    <Grid
                                        Padding="0"
                                        DataContext="{Binding HardChallengeEntries.CurrentItem}"
                                        RowSpacing="8"
                                        Visibility="{Binding Converter={StaticResource EmptyObjectToVisibilityConverter}, FallbackValue=Collapsed}">
                                        <Pivot
                                            ItemsSource="{Binding DataEntries}"
                                            SelectedIndex="0"
                                            Style="{ThemeResource CardPivotStyle}">
                                            <Pivot.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}"/>
                                                </DataTemplate>
                                            </Pivot.ItemTemplate>
                                            <Pivot.HeaderTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Name}"/>
                                                </DataTemplate>
                                            </Pivot.HeaderTemplate>
                                        </Pivot>
                                    </Grid>
                                </ScrollViewer>
                            </SplitView.Content>
                        </SplitView>
                    </Border>
                </Border>
            </PivotItem>

            <PivotItem Header="{shuxm:ResourceString Name=ViewSpiralAbyssHutaoStatistics}">
                <Border Margin="16" cw:Effects.Shadow="{ThemeResource CompatCardShadow}">
                    <Grid Style="{ThemeResource AcrylicGridCardStyle}">
                        <GridView
                            Padding="16,16,4,4"
                            ItemContainerStyle="{StaticResource LargeGridViewItemStyle}"
                            ItemTemplate="{StaticResource AvatarViewTemplate}"
                            ItemsSource="{Binding BlingAvatars}"
                            SelectionMode="None"/>
                    </Grid>
                </Border>
            </PivotItem>
        </Pivot>
    </Grid>
</shuxc:ScopedPage>